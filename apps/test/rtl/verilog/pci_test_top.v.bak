module pci_test_top
(
    pci_clk_pad_i,
    pci_rst_pad_i,
    clk_pad_i,

    pci_req_pad_o,
    pci_gnt_pad_i,
    pci_idsel_pad_i,

    pci_ad_pad_io,
    pci_cbe_pad_io,

    pci_frame_pad_io,
    pci_irdy_pad_io,
    pci_devsel_pad_io,
    pci_trdy_pad_io,        
    pci_stop_pad_io,
    pci_par_pad_io,
    pci_perr_pad_io
);

// input/output inout declarations
input pci_clk_pad_i,
      pci_rst_pad_i,
      clk_pad_i ;

output pci_req_pad_o ;
input  pci_gnt_pad_i, 
       pci_idsel_pad_i ;

inout [31:0] pci_ad_pad_io ;
inout [3:0]  pci_cbe_pad_io ;
inout        pci_frame_pad_io,
             pci_irdy_pad_io,
             pci_devsel_pad_io,
             pci_trdy_pad_io,
             pci_stop_pad_io,
             pci_par_pad_io,
             pci_perr_pad_io ;

// wires for test master to pci slave connections
wire wbm_test_wbs_pci_cyc,
     wbm_test_wbs_pci_stb,
     wbm_test_wbs_pci_cab,
     wbm_test_wbs_pci_we,
     wbs_pci_wbm_test_ack ;

wire [31:0] wbm_test_wbs_pci_adr,
            wbm_test_wbs_pci_dat,
            wbs_pci_wbm_test_dat ;

wire [3:0]  wbm_test_wbs_pci_sel ;

// wires for test slave to pci master connections
wire wbm_pci_wbs_test_cyc,
     wbm_pci_wbs_test_stb,
     wbm_pci_wbs_test_cab,
     wbm_pci_wbs_test_we,
     wbs_test_wbm_pci_ack ;

wire [31:0] wbm_pci_wbs_test_adr,
            wbm_pci_wbs_test_dat,
            wbs_test_wbm_pci_dat ;

wire [3:0]  wbm_pci_wbs_test_sel ;

test i_test
(
    .clk_i     (clk_pad_i),
    .rst_i     (1'b0),

    .wbm_cyc_o (wbm_test_wbs_pci_cyc),
    .wbm_stb_o (wbm_test_wbs_pci_stb),
    .wbm_cab_o (wbm_test_wbs_pci_cab),
    .wbm_we_o  (wbm_test_wbs_pci_we),
    .wbm_adr_o (wbm_test_wbs_pci_adr),
    .wbm_sel_o (wbm_test_wbs_pci_sel),
    .wbm_dat_o (wbm_test_wbs_pci_dat),
    .wbm_dat_i (wbs_pci_wbm_test_dat),
    .wbm_ack_i (wbs_pci_wbm_test_ack),
    .wbm_rty_i (1'b0),
    .wbm_err_i (1'b0),

    .wbs_cyc_i (wbm_pci_wbs_test_cyc),
    .wbs_stb_i (wbm_pci_wbs_test_stb),
    .wbs_cab_i (wbm_pci_wbs_test_cab),
    .wbs_we_i  (wbm_pci_wbs_test_we),
    .wbs_adr_i (wbm_pci_wbs_test_adr),
    .wbs_sel_i (wbm_pci_wbs_test_sel),
    .wbs_dat_i (wbm_pci_wbs_test_dat),
    .wbs_dat_o (wbs_test_wbm_pci_dat),
    .wbs_ack_o (wbs_test_wbm_pci_ack),
    .wbs_rty_o (),
    .wbs_err_o ()
);

wire pci_req_o,
     pci_req_oe,
     pci_frame_i,
     pci_frame_o,
     pci_frame_oe,
     pci_irdy_oe,
     pci_devsel_oe,
     pci_trdy_oe,
     pci_stop_oe,
     pci_irdy_i,
     pci_irdy_o,
     pci_devsel_i,
     pci_devsel_o,
     pci_trdy_i,
     pci_trdy_o,
     pci_stop_i,
     pci_stop_o,
     pci_par_i,
     pci_par_o,
     pci_par_oe,
     pci_perr_i,
     pci_perr_o,
     pci_perr_oe,
     pci_serr_o,
     pci_serr_oe
;

wire [31:0] pci_ad_oe,
            pci_ad_i,
            pci_ad_o ;

wire [3:0]  pci_cbe_oe,
            pci_cbe_i,
            pci_cbe_o ;
     
bufif0 ad_buffer [31:0] (pci_ad_pad_io,  pci_ad_o,  pci_ad_oe) ;
bufif0 cbe_buffer [3:0] (pci_cbe_pad_io, pci_cbe_o, pci_cbe_oe) ;

assign pci_ad_i  = pci_ad_pad_io ;
assign pci_cbe_i = pci_cbe_pad_io ;

bufif0 req_buf (pci_req_pad_o, pci_req_o, pci_req_oe) ;

bufif0 frame_buf (pci_frame_pad_io, pci_frame_o, pci_frame_oe) ;
assign pci_frame_i = pci_frame_pad_io ;
bufif0 irdy_buf (pci_irdy_pad_io, pci_irdy_o, pci_irdy_oe) ;
assign pci_irdy_i = pci_irdy_pad_io ;
bufif0 devsel_buf (pci_devsel_pad_io, pci_devsel_o, pci_devsel_oe) ;
assign pci_devsel_i = pci_devsel_pad_io ;
bufif0 trdy_buf (pci_trdy_pad_io, pci_trdy_o, pci_trdy_oe) ;
assign pci_trdy_i = pci_trdy_pad_io ;
bufif0 stop_buf (pci_stop_pad_io, pci_stop_o, pci_stop_oe) ;
assign pci_stop_i = pci_stop_pad_io ;
bufif0 par_buf (pci_par_pad_io, pci_par_o, pci_par_oe) ;
assign pci_par_i = pci_par_pad_io ;
bufif0 perr_buf (pci_perr_pad_io, pci_perr_o, pci_perr_oe) ;
assign pci_perr_i = pci_perr_pad_io ;
bufif0 serr_buf (pci_serr_pad_o, pci_serr_o, pci_serr_oe) ;

pci_bridge32 i_pci_bridge32
(
    // WISHBONE system signals
    .wb_clk_i(clk_pad_i),
    .wb_rst_i(~pci_rst_pad_i),
    .wb_rst_o(),
    .wb_int_i(1'b0),
    .wb_int_o(),

    // WISHBONE slave interface
    .wbs_adr_i(wbm_test_wbs_pci_adr),
    .wbs_dat_i(wbm_test_wbs_pci_dat),
    .wbs_dat_o(wbs_pci_wbm_test_dat),
    .wbs_sel_i(wbm_test_wbs_pci_sel),
    .wbs_cyc_i(wbm_test_wbs_pci_cyc),
    .wbs_stb_i(wbm_test_wbs_pci_stb),
    .wbs_we_i (wbm_test_wbs_pci_we),
    .wbs_cab_i(wbm_test_wbs_pci_cab),
    .wbs_ack_o(wbs_pci_wbm_test_ack),
    .wbs_rty_o(),
    .wbs_err_o(),

    // WISHBONE master interface
    .wbm_adr_o(wbm_pci_wbs_test_adr),
    .wbm_dat_i(wbm_pci_wbs_test_dat),
    .wbm_dat_o(wbs_test_wbm_pci_dat),
    .wbm_sel_o(wbm_pci_wbs_test_sel),
    .wbm_cyc_o(wbm_pci_wbs_test_cyc),
    .wbm_stb_o(wbm_pci_wbs_test_stb),
    .wbm_we_o (wbm_pci_wbs_test_we),
    .wbm_cab_o(wbm_pci_wbs_test_cab),
    .wbm_ack_i(wbs_test_wbm_pci_ack),
    .wbm_rty_i(1'b0),
    .wbm_err_i(1'b0),

    // pci interface - system pins
    .pci_clk_i      (pci_clk_pad_i),
    .pci_rst_i      (pci_rst_pad_i),
    .pci_rst_o      (),
    .pci_inta_i     (1'b1),
    .pci_inta_o     (),
    .pci_rst_oe_o   (),
    .pci_inta_oe_o  (),

    // arbitration pins
    .pci_req_o      (pci_req_o),
    .pci_req_oe_o   (pci_req_oe),

    .pci_gnt_i      (pci_gnt_pad_i),

    // protocol pins
    .pci_frame_i    (pci_frame_i),
    .pci_frame_o    (pci_frame_o),

    .pci_frame_oe_o (pci_frame_oe),
    .pci_irdy_oe_o  (pci_irdy_oe),
    .pci_devsel_oe_o(pci_devsel_oe),
    .pci_trdy_oe_o  (pci_trdy_oe),
    .pci_stop_oe_o  (pci_stop_oe),
    .pci_ad_oe_o    (pci_ad_oe),
    .pci_cbe_oe_o   (pci_cbe_oe),

    .pci_irdy_i     (pci_irdy_i),
    .pci_irdy_o     (pci_irdy_o),

    .pci_idsel_i    (pci_idsel_pad_i),

    .pci_devsel_i   (pci_devsel_i),
    .pci_devsel_o   (pci_devsel_o),

    .pci_trdy_i     (pci_trdy_i),
    .pci_trdy_o     (pci_trdy_o),

    .pci_stop_i     (pci_stop_i),
    .pci_stop_o     (pci_stop_o),

    // data transfer pins
    .pci_ad_i       (pci_ad_i),
    .pci_ad_o       (pci_ad_o),

    .pci_cbe_i      (pci_cbe_i),
    .pci_cbe_o      (pci_cbe_o),

    // parity generation and checking pins
    .pci_par_i      (pci_par_i),
    .pci_par_o      (pci_par_o),
    .pci_par_oe_o   (pci_par_oe),

    .pci_perr_i     (pci_perr_i),
    .pci_perr_o     (pci_perr_o),
    .pci_perr_oe_o  (pci_perr_oe),

    // system error pin
    .pci_serr_o     (pci_serr_o),
    .pci_serr_oe_o  (pci_serr_oe)
);
endmodule // pci_test_top